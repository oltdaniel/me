---
layout: post
title: "COVID-19 analysis"
author: Daniel Oltmanns
tags: analysis, covid-19
---
<p>COVID-19 is a virus that spreads rapidly and has been confirmed nearly all over the globe. The "Johns Hopkins Whiting
School of Engineering" has an great dataset of COVID-19 cases across the globe per Country/Region. I mirror their 
dataset to an own format by having each country in another csv file to
<a href="https://c.oltdaniel.at/datasets" target="_blank"><em>htps://c.oltdaniel.at/datasets</em></a>. To see what we
    can do with the data I create some simple graphics in this article.</p>

<!--abstract-->

<hr>

<blockquote><b>NOTE:</b> I am not an professional. This is just some visualizations of real-world data and guesses which crunched
numbers are important and to look at.</blockquote>

<h3>worldwide</h3>

<p>Here an overview of the worldwide data. These numbers have been calculated by adding the cases of each category per
    country per day.</p>

<canvas id="c-world" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<h3>Italy</h3>

<canvas id="c-italy" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<h3>US</h3>

<canvas id="c-us" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<h3>Germany</h3>

<canvas id="c-germany" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<h3>China</h3>

<canvas id="c-china" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<h3>Spain</h3>

<canvas id="c-spain" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<h3>UK</h3>

<canvas id="c-uk" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<h3>India</h3>

<canvas id="c-india" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<h3>Russia</h3>

<canvas id="c-russia" height="480" width="854"></canvas>
<p>confirmed(orange), recovered(green), deaths(red), active(blue), new confirmed per day(purple|off-scale)</p>

<b>NOTE:</b> new charts will follow

<!--scripts-->
<script src="{{ '/assets/canvas.js' | absolute_url }}" charset="utf-8"></script>
<script src="{{ '/assets/csv.js' | absolute_url }}" charset="utf-8"></script>
<script>
const URL_BASE = 'https://c.oltdaniel.at/datasets/';
let dataCache = {};

function findMax(data) {
    let maxValue = data[0];
    for(let i = 1; i < data.length; i++) {
        if(data[i] > maxValue) {
            maxValue = data[i];
        }
    }
    return maxValue;
}

function CheckOnPushArray(opts) {
    this.data = [];
    this.opts = opts;
}

CheckOnPushArray.prototype.push = function(item) {
    this.data.push(item);
    for(let i = 0; i < this.opts.length; i++) {
        let itemIndex = this.opts[i].requires.indexOf(item);
        if(itemIndex > -1) {
            this.opts[i].requires.splice(itemIndex, 1);
            if(this.opts[i].requires.length === 0) {
                this.opts[i].call();
            }
        }
    }
};

function o() {
    // get charts
    let charts = {
            'world': new Chart('c-world'),
            'italy': new Chart('c-italy'),
            'us': new Chart('c-us'),
            'germany': new Chart('c-germany'),
            'china': new Chart('c-china'),
            'spain': new Chart('c-spain'),
            'united_kingdom': new Chart('c-uk'),
            'india': new Chart('c-india'),
            'russia': new Chart('c-russia'),
        },
        chartsKeys = Object.keys(charts);
    // set triggers and callbacks
    let drawCallback = function(tag, chart, column, lineColor, updateMax, state = null) {
        return function(filedata) {
            let csv = new CSV(filedata, state);
            let data = csv.allValuesByHeader(column);
            dataCache[tag] = csv;
            if(updateMax) {
                let max = findMax(data);
                chart.setMax(max);
            }
            chart.drawData(data, lineColor);
            drawnCharts.push(tag);
        };
    };
    let generateActiveData = function(tag, chart) {
        let activeData = [];
        let confirmed = dataCache[tag + '.confirmed'].allValuesByHeader('confirmed'),
            recovered = dataCache[tag + '.recovered'].allValuesByHeader('recovered'),
            deaths = dataCache[tag + '.deaths'].allValuesByHeader('deaths');
        for(let i = 0; i < dataCache[tag + '.confirmed'].lines.length; i++) {
            activeData[i] = confirmed[i] - recovered[i] - deaths[i]; 
        }
        dataCache[tag + '.active'] = activeData;
        drawnCharts.push(tag + '.active');
        chart.drawData(activeData, '#2196F3');
    };
    let triggers = [];
    let addCountry = function(country) {
        if(country.indexOf('.') > -1) {
            let statep = country.split('.');
            let state = statep[1];
            triggers.push({
                call: function () {
                    generateActiveData(country, charts[country], state);
                    drawCallback(country + '.difference', charts[country], 'difference', '#673AB7', true, state)(dataCache[country + '.confirmed'].raw);
                },
                requires: [country + '.confirmed', country + '.recovered', country + '.deaths']
            });
        } else {
            triggers.push({
                call: function () {
                    generateActiveData(country, charts[country]);
                    drawCallback(country + '.difference', charts[country], 'difference', '#673AB7', true)(dataCache[country + '.confirmed'].raw);
                },
                requires: [country + '.confirmed', country + '.recovered', country + '.deaths']
            });
        }
        triggers.push({
            call: function() {
                fileByUrl(URL_BASE + country + '.recovered.csv', drawCallback(country + '.recovered', charts[country], 'recovered', '#4CAF50', false));
            },
            requires: [country + '.confirmed']
        });
        triggers.push({
            call: function() {
                fileByUrl(URL_BASE + country + '.deaths.csv', drawCallback(country + '.deaths', charts[country], 'deaths', '#F44336', false));
            },
            requires: [country + '.recovered']
        });
    };
    for(let i = 0; i < chartsKeys.length; i++) {
        addCountry(chartsKeys[i]);
    }
    let drawnCharts = new CheckOnPushArray(triggers);

    let executeCountry = function(country) {
        let countryName = country;
        let state = null;
        if(country.indexOf('.') > -1) {
            let statep = country.split('.');
            countryName = statep[0];
            state = statep[1];
        }
        fileByUrl(URL_BASE + countryName + '.confirmed.csv', drawCallback(country + '.confirmed', charts[country], 'confirmed', '#FF9800', true, state));
    };
    for(let i = 0; i < chartsKeys.length; i++) {
        executeCountry(chartsKeys[i]);
    }
}
</script>